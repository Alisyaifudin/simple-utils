var m=(n,t,e)=>new Promise((o,r)=>{var c=a=>{try{l(e.next(a))}catch(h){r(h)}},u=a=>{try{l(e.throw(a))}catch(h){r(h)}},l=a=>a.done?o(a.value):Promise.resolve(a.value).then(c,u);l((e=e.apply(n,t)).next())});import{getElement as i}from"./share/element.js";import{state$ as S}from"./share/state$.js";function T(n){n.setter(t=>([t.from,t.to]=[t.to,t.from],t))}function w(n,t){return function(){let e=n.value;if(!I(e))return;let o=t.get.to;t.get.to===e&&(o=t.get.from),t.set={from:e,to:o}}}function y(n,t){return function(){let e=n.value;if(!I(e))return;let o=t.get.from;t.get.from===e&&(o=t.get.to),t.set={from:o,to:e}}}function I(n){return n==="png"||n==="webp"||n==="jpeg"}function v(n,t){return function(){return m(this,null,function*(){let e=n.files;if(e===null||e.length===0){t.set=null;return}t.set=e[0]})}}function L(n,t,e){return m(this,null,function*(){if(n===null){t.src="",t.hidden=!0;return}let o=yield E(n,e.get.to);t.src=o,t.hidden=!1})}var E=(n,t)=>m(null,null,function*(){let e=new Image,o=document.createElement("canvas"),r=o.getContext("2d");if(!r)throw new Error("Could not get canvas context");return new Promise((c,u)=>{e.onload=()=>{o.width=e.width,o.height=e.height,r.drawImage(e,0,0);try{let l=o.toDataURL(`image/${t}`,.85);c(l)}catch(l){u(l)}},e.onerror=()=>{u(new Error("Failed to load image"))},e.src=URL.createObjectURL(n)})});var p=i("#file-input"),H=i("img"),f=S(null);p.addEventListener("change",v(p,f));var s=S({from:"png",to:"webp"});f.addEffect(n=>L(n,H,s));var g=i("#from"),d=i("#to"),M=g.querySelectorAll("option"),$=d.querySelectorAll("option");if(!(g instanceof HTMLSelectElement))throw new Error("from is not a select");if(!(d instanceof HTMLSelectElement))throw new Error("to is not a select");g.addEventListener("change",w(g,s));d.addEventListener("change",y(d,s));var x=i("#switch");x.addEventListener("click",()=>T(s));s.addEffect(n=>{let t=n.from;p.value="",p.accept=`image/${t}`,f.set=null,M.forEach(e=>{e.selected=e.value===n.from}),$.forEach(e=>{e.selected=e.value===n.to})});var F=i("#convert-btn");f.addEffect(n=>{F.disabled=n===null});F.addEventListener("click",()=>m(null,null,function*(){let n=f.get;if(n===null)return;let t=s.get.to,e=n.name.split("."),o=e.length>1?`${e.slice(0,e.length-1).join()}.${t}`:`${n.name}.${t}`,r=yield E(n,t),c=document.createElement("a");c.href=r,c.download=o,c.click()}));
